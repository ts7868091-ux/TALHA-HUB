<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TALHA HUB - Temp Mail</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
  body {
    background-color: #0a0a1a;
    color: #fff;
    font-family: 'Poppins', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
    margin: 0;
    padding: 20px;
  }
  h1 {
    color: #00ffff;
    margin-bottom: 10px;
  }
  #emailDisplay {
    background: #111;
    border: 2px solid #00ffff;
    padding: 10px 20px;
    border-radius: 10px;
    word-break: break-all;
    font-weight: 600;
    margin-bottom: 15px;
  }
  button {
    background: #00ffff;
    border: none;
    color: #000;
    font-weight: 600;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    margin: 5px;
  }
  button:hover {
    background: #00cccc;
  }
  ul {
    list-style: none;
    padding: 0;
    width: 100%;
    max-width: 400px;
  }
  li {
    background: #111;
    border: 1px solid #00ffff;
    margin: 5px 0;
    padding: 8px;
    border-radius: 8px;
    cursor: pointer;
  }
  #messageContent {
    background: #111;
    border: 2px solid #00ffff;
    border-radius: 10px;
    padding: 15px;
    width: 100%;
    max-width: 400px;
    margin-top: 10px;
    min-height: 100px;
    word-wrap: break-word;
  }
  footer {
    margin-top: 20px;
    color: #00ffff;
    font-weight: 600;
  }
</style>
</head>
<body>
  <h1>Temp Mail</h1>
  <div id="emailDisplay">No email generated</div>
  <div>
    <button onclick="generateEmail()">Generate Email</button>
    <button onclick="checkInbox()">Check Inbox</button>
  </div>
  <p id="status" style="color:#00ffff;font-weight:600;margin-top:10px;">Ready</p>
  <ul id="inboxList"><li>No inbox yet</li></ul>
  <div id="messageContent">No message selected.</div>
  <footer>POWERED BY TALHA SHAIKH ðŸ’¯</footer>

<script>
let currentEmail = "";
const emailDisplay = document.getElementById("emailDisplay");
const inboxList = document.getElementById("inboxList");
const messageContent = document.getElementById("messageContent");
const statusDisplay = document.getElementById("status");

function setStatus(msg) {
  statusDisplay.textContent = msg;
}

function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    console.log("Copied:", text);
  });
}

async function generateEmail() {
  setStatus("Generating new email...");
  emailDisplay.textContent = "...";
  inboxList.innerHTML = "<li>Loading...</li>";

  try {
    const res = await fetch("https://api.internal.temp-mail.io/api/v3/email/new", {
      method: "POST",
      headers: {
        "application-name": "web",
        "application-version": "4.0.0",
        "x-cors-header": "iaWg3pchvFx48fY",
        "content-type": "application/json",
        "accept": "*/*",
        "origin": "https://temp-mail.io",
        "x-requested-with": "mark.via.gp"
      },
      body: JSON.stringify({ min_name_length: 10, max_name_length: 10 })
    });

    const data = await res.json();
    console.log("API Response:", data);

    let email =
      data.email ||
      data.address ||
      (data.data && (data.data.email || data.data.address)) ||
      (data.result && (data.result.email || data.result.address));

    if (email) {
      currentEmail = email;
      emailDisplay.textContent = currentEmail;
      setStatus("Email generated successfully!");
      copyToClipboard(currentEmail);
    } else {
      emailDisplay.textContent = "-- Error --";
      setStatus("Error: Could not get email from API.");
      console.log("Response:", data);
    }
  } catch (err) {
    console.error(err);
    setStatus("Network error while generating email.");
    emailDisplay.textContent = "-- Error --";
  }
}

async function checkInbox() {
  if (!currentEmail) {
    setStatus("Generate an email first.");
    return;
  }

  setStatus("Checking inbox...");
  inboxList.innerHTML = "<li>Loading...</li>";

  try {
    const url = `https://api.internal.temp-mail.io/api/v3/email/${encodeURIComponent(currentEmail)}/messages`;

    const res = await fetch(url, {
      method: "GET",
      headers: {
        "application-name": "web",
        "application-version": "4.0.0",
        "x-cors-header": "iaWg3pchvFx48fY",
        "content-type": "application/json",
        "accept": "*/*",
        "origin": "https://temp-mail.io",
        "x-requested-with": "mark.via.gp"
      }
    });

    const data = await res.json();
    console.log("Inbox Data:", data);

    let messages =
      (Array.isArray(data) && data) ||
      data.messages ||
      data.data ||
      data.result ||
      data.items;

    inboxList.innerHTML = "";

    if (!messages || !messages.length) {
      inboxList.innerHTML = "<li>No messages yet.</li>";
      setStatus("Inbox empty.");
      return;
    }

    messages.forEach((msg, index) => {
      const li = document.createElement("li");
      li.textContent = msg.subject || `Message ${index + 1}`;
      li.onclick = () => loadMessage(msg);
      inboxList.appendChild(li);
    });

    setStatus("Inbox updated.");
  } catch (err) {
    console.error(err);
    inboxList.innerHTML = "<li>Error loading inbox.</li>";
    setStatus("Network error while checking inbox.");
  }
}

function loadMessage(msg) {
  messageContent.innerHTML =
    `<strong>From:</strong> ${msg.from || "Unknown"}<br>` +
    `<strong>Subject:</strong> ${msg.subject || "No subject"}<br><br>` +
    `${msg.body_text || msg.body_html || msg.text || msg.body || "No content"}`;
  setStatus("Message loaded.");
}
</script>
</body>
</html>
